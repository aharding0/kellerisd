<!DOCTYPE html>

<html lang="en">

  <head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="theme-color" content="#33b5e5">
    <link rel="manifest" href="/manifest.json">
    <!-- Google Fonts Roboto -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-2/css/all.min.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/perfect-scrollbar@1.5.0/css/perfect-scrollbar.css">

    <div class="container my-5">

      <div class="row">

        <div class="col-md-7 mb-4 mb-md-0">



          <!-- Table -->
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Item</th>
                <th>Options</th>
                <th>Price</th>
                <th>Quantity</th>
                <th></th>
                <th>Keywords</th>
              </tr>
            </thead>
            <tbody id="demo"></tbody>
          </table>

        </div>

      </div>
    </div>
  </head>

  <script>
    let xmlhttp = new XMLHttpRequest();
    var itemQty = [],
      item = [],
      options = [],
      price = [],
      keywords = [];
    var count = 1;
    xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        let data = JSON.parse(this.responseText).feed.entry;
        let i, j,k;


        for (i = 0; i < data.length; i++) {
          item.push(data[i]["gsx$item"]["$t"]);
          options.push(data[i]["gsx$options"]["$t"]);
          price.push(data[i]["gsx$price"]["$t"]);
          keywords.push(data[i]["gsx$keywords"]["$t"]);

          let qty, btn;
          let optionsList = [];
          let options1 = "";
          itemQty[i] = 0;

          //split options into a list which is reset in forloop. catch empty string as null ie. no options for that item
          optionsList = options[i].split(",");
          if (options[i].split(",") == "") {
            optionsList = null;
          }

          // if optionsList is not null/empty then now its time to make the option list
          if (optionsList) {
            //outside for-loop need to begin dropdown tag
            options1 += "<select id='opt" + i + "''>";

            //for loop going through the comma , separated list of options
            for (j = 0; j < optionsList.length; j++) {

              //call each option from array and add to dropdown
              options1 += "<option>" + optionsList[j] + "</option>";

            }
            //outside end of for-loop leave tailing/end dropdown tag
            options1 += "</select>";
          } else {
            //empty list - no option/dropdown desired
            options1 = "";
          }

          qty = "<select onchange='setQty(" + i + ")' id='qty" + i + "'><option value='0'>---</option>"
         for (k=1;k<=200;k++)
         {
         	qty+="<option value='"+k+"''>"+k+"</option>";
         }

          btn = "<button onclick='addToOrder(" + i + ")'type='button'>Add</button>"

          document.getElementById("demo").innerHTML +=
            "<tr>" +
            "<td>" +
            item[i] +
            "</td>" +
            "<td>" +
            options1 +
            "</td>" +
            "<td>" +
            price[i] +
            "</td>" +
            "<td>" +
            qty +
            "</td>" +
            "<td>" +
            btn +
            "</td>" +
            "<td>" +
            keywords[i] +
            "</td>" +
            "</tr>";
        }
      }
    };

    xmlhttp.open(
      "GET",
      "https://spreadsheets.google.com/feeds/list/15gT8DzszGlCgqA4QOU_rVssCSEWGxniuBiqDSbOwI8Y/3/public/full?alt=json",
      true
    );
    xmlhttp.send();

    function setQty(selection) {
      itemQty[selection] = document.getElementById("qty" + selection).value;
    }

    function addToOrder(myItem) 
    {
    	var myOption;
      if(document.getElementById("opt"+myItem)){
      	myOption = " (" + document.getElementById("opt"+myItem).value + ") ";
      }else{myOption="";}
      
      if (itemQty[myItem] > 0) 
      {
        document.getElementById("entry.1873909031").innerHTML += 
        count + ". " + item[myItem] + myOption +
        " - Quantity: " + itemQty[myItem] + "\n"
        count++;
        document.getElementById("qty"+myItem).selectedIndex = 0;
      }

    }

  </script>
  <label>
    <span class="displayorder">Order: <br><br>
    <button onclick='document.getElementById("entry.1873909031").innerHTML=""' type="button">Clear My Order</button></span>
    <textarea textarea rows="10" cols="40" wrap="hard" style="" type="text" onkeypress="return false;" name="entry.1873909031" id="entry.1873909031" required></textarea>
  </label>

</html>
