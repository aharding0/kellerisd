<!DOCTYPE html>

<html lang="en">

  <head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="theme-color" content="#33b5e5">
    <link rel="manifest" href="/manifest.json">
    <!-- Google Fonts Roboto -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-2/css/all.min.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/perfect-scrollbar@1.5.0/css/perfect-scrollbar.css">

    <div class="container my-5">

      <div class="row">

        <div class="col-md-7 mb-4 mb-md-0">



          <!-- Table -->
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Item</th>
                <th>Options</th>
                <th></th>
                <th></th>
                <th>Price</th>
                <th>Quantity</th>
                <th></th>
                <th>Keywords</th>
              </tr>
            </thead>
            <tbody id="demo"></tbody>
          </table>

        </div>

      </div>
    </div>
  </head>

  <script>
    let xmlhttp = new XMLHttpRequest();
    var itemQty = [];
    var item = [];
    var options1 = [];
    var options2 = [];
    var options3 = [];
    var price = [];
    var keywords = [];
    var count = 1;
    var total;
    xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        let data = JSON.parse(this.responseText).feed.entry;
        let i, j,k;


        for (i = 0; i < data.length; i++) {
          item.push(data[i]["gsx$item"]["$t"]);
          options1.push(data[i]["gsx$options1"]["$t"]);
          options2.push(data[i]["gsx$options2"]["$t"]);
          options3.push(data[i]["gsx$options3"]["$t"]);
          price.push(data[i]["gsx$price"]["$t"]);
          keywords.push(data[i]["gsx$keywords"]["$t"]);

          let qty, btn;
          let optionsList1 = [];
          let optionsList2 = [];
          let optionsList3 = [];
          let optionsDropdown1 = "";
          let optionsDropdown2 = "";
          let optionsDropdown3 = "";
          itemQty[i] = 0;

          //split options into a list which is reset in forloop. catch empty string as null ie. no options for that item
          optionsList1 = options1[i].split(",");
          if (options1[i].split(",") == "") {
            optionsList1 = null;
          }
          optionsList2 = options2[i].split(",");
          if (options2[i].split(",") == "") {
            optionsList2 = null;
          }
          optionsList3 = options3[i].split(",");
          if (options3[i].split(",") == "") {
            optionsList3 = null;
          }

          // if optionsList is not null/empty then now its time to make the option list
          if (optionsList1) {
            //outside for-loop need to begin dropdown tag
            optionsDropdown1 += "<select id='opt1" + i + "''>";

            //for loop going through the comma , separated list of options
            for (j = 0; j < optionsList1.length; j++) {

              //call each option from array and add to dropdown
              optionsDropdown1 += "<option>" + optionsList1[j] + "</option>";

            }
            //outside end of for-loop leave tailing/end dropdown tag
            optionsDropdown1 += "</select>";
          } else {
            //empty list - no option/dropdown desired
            optionsDropdown1 = "";
          }
          if (optionsList2) {
            //outside for-loop need to begin dropdown tag
            optionsDropdown2 += "<select id='opt2" + i + "''>";

            //for loop going through the comma , separated list of options
            for (j = 0; j < optionsList2.length; j++) {

              //call each option from array and add to dropdown
              optionsDropdown2 += "<option>" + optionsList2[j] + "</option>";

            }
            //outside end of for-loop leave tailing/end dropdown tag
            optionsDropdown2 += "</select>";
          } else {
            //empty list - no option/dropdown desired
            optionsDropdown2 = "";
          }
          if (optionsList3) {
            //outside for-loop need to begin dropdown tag
            optionsDropdown3 += "<select id='opt3" + i + "''>";

            //for loop going through the comma , separated list of options
            for (j = 0; j < optionsList3.length; j++) {

              //call each option from array and add to dropdown
              optionsDropdown3 += "<option>" + optionsList3[j] + "</option>";

            }
            //outside end of for-loop leave tailing/end dropdown tag
            optionsDropdown3 += "</select>";
          } else {
            //empty list - no option/dropdown desired
            optionsDropdown3 = "";
          }
          
          
          

          qty = "<select onchange='setQty(" + i + ")' id='qty" + i + "'><option value='0'>---</option>"
         for (k=1;k<=200;k++)
         {
         	qty+="<option value='"+k+"''>"+k+"</option>";
         }

          btn = "<button onclick='addToOrder(" + i + ")'type='button'>Add</button>"

          document.getElementById("demo").innerHTML +=
            "<tr>" +
            "<td>" +
            item[i] +
            "</td>" +
            "<td>" +
            optionsDropdown1 +
            "</td>" +
            "<td>" +
            optionsDropdown2 +
            "</td>" +
            "<td>" +
            optionsDropdown3 +
            "</td>" +
            "<td>" +
            price[i] +
            "</td>" +
            "<td>" +
            qty +
            "</td>" +
            "<td>" +
            btn +
            "</td>" +
            "<td>" +
            keywords[i] +
            "</td>" +
            "</tr>";
            
            price[i]= price[i].replace(/[$]/g, "");
        }
      }
    };

    xmlhttp.open(
      "GET",
      "https://spreadsheets.google.com/feeds/list/15gT8DzszGlCgqA4QOU_rVssCSEWGxniuBiqDSbOwI8Y/3/public/full?alt=json",
      true
    );
    xmlhttp.send();

    function setQty(selection) {
      itemQty[selection] = document.getElementById("qty" + selection).value;
    }

    function addToOrder(myItem) 
    {
    	var myOption;
      if(document.getElementById("opt"+myItem)){
      	myOption = " (" + document.getElementById("opt"+myItem).value + ") ";
      }else{myOption="";}
      
      if (itemQty[myItem] > 0) 
      {
        document.getElementById("entry.1873909031").innerHTML += 
        count + ". " + item[myItem] + myOption +
        " - Quantity: " + itemQty[myItem] + "\n"
        count++;
        document.getElementById("qty"+myItem).selectedIndex = 0;
        total += itemQty[myItem]*price[myItem];
      }

    }

  </script>
  <label>
    <span class="displayorder">Order: <br><br>
    <button onclick='document.getElementById("entry.1873909031").innerHTML=""' type="button">Clear My Order</button></span>
    <textarea textarea rows="10" cols="40" wrap="hard" style="" type="text" onkeypress="return false;" name="entry.1873909031" id="entry.1873909031" required></textarea>
  </label>

</html>
